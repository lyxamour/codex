# Codex AI 用户指南

## 1. 简介

Codex AI 是一个基于 CLI 的 AI 编程工具，旨在提供高效的编程辅助和知识管理功能。它可以帮助你索引代码、解释代码、生成代码、回答编程问题等。

## 2. 安装

### 2.1 安装方式

#### 使用安装脚本

```bash
curl -sSL https://raw.githubusercontent.com/lyxamour/codex/main/scripts/install/install.sh | bash
```

#### 使用包管理器

##### macOS (Homebrew)

```bash
brew tap lyxamour/codex
brew install codex
```

##### Linux (APT)

```bash
echo "deb [trusted=yes] https://apt.lyxamour.com/ stable main" | sudo tee /etc/apt/sources.list.d/lyxamour.list
sudo apt update
sudo apt install codex
```

### 2.2 验证安装

```bash
codex --version
```

如果安装成功，会显示当前 Codex 的版本信息，例如：
```
codex 1.0.0
```

## 3. 快速开始

### 3.1 配置 AI 平台

在使用 Codex 之前，你需要配置 AI 平台的 API 密钥。Codex 支持 OpenAI、Anthropic 和 Ollama。

#### 环境变量配置

```bash
# OpenAI
export OPENAI_API_KEY="your-openai-api-key"

# Anthropic
export ANTHROPIC_API_KEY="your-anthropic-api-key"
```

#### 配置文件配置

编辑 `~/.codex/config.yaml` 文件：

```yaml
ai:
  default_platform: openai
  platforms:
    openai:
      api_key: "your-openai-api-key"
    anthropic:
      api_key: "your-anthropic-api-key"
```

### 3.2 索引代码

```bash
# 索引当前目录
codex index .

# 递归索引目录
codex index --recursive /path/to/your/codebase

# 排除特定目录
codex index --exclude target --exclude node_modules .
```

### 3.3 基本使用

#### 询问问题

```bash
codex ask "如何实现快速排序算法？"
```

#### 解释代码

```bash
codex explain /path/to/your/code.rs
```

#### 生成代码

```bash
codex generate "创建一个 Rust 函数，计算两个数的和"
```

#### 交互式聊天

```bash
codex chat
```

## 4. 核心功能

### 4.1 代码索引

Codex 可以索引你的代码库，方便后续进行代码搜索和分析。

#### 索引命令

```bash
codex index [OPTIONS] <PATH>
```

#### 索引选项

| 选项 | 描述 |
|------|------|
| `-r, --recursive` | 递归索引目录 |
| `-e, --exclude <EXCLUDE>` | 排除特定目录 |
| `--max-file-size <SIZE>` | 跳过超过指定大小的文件（单位：MB） |
| `--force` | 强制重新索引 |
| `--verbose` | 显示详细日志 |

### 4.2 代码解释

Codex 可以帮助你理解代码的功能和实现原理。

#### 解释命令

```bash
codex explain [OPTIONS] <FILE>
```

#### 解释选项

| 选项 | 描述 |
|------|------|
| `--context <CONTEXT>` | 添加上下文文件 |
| `--language <LANGUAGE>` | 指定编程语言 |
| `--model <MODEL>` | 指定 AI 模型 |

### 4.3 代码生成

Codex 可以根据你的需求生成代码。

#### 生成命令

```bash
codex generate [OPTIONS] <PROMPT>
```

#### 生成选项

| 选项 | 描述 |
|------|------|
| `--language <LANGUAGE>` | 指定生成的编程语言 |
| `--framework <FRAMEWORK>` | 指定使用的框架 |
| `--model <MODEL>` | 指定 AI 模型 |
| `--output <FILE>` | 将生成的代码保存到文件 |

### 4.4 交互式聊天

Codex 提供了交互式聊天界面，可以进行更深入的对话。

#### 聊天命令

```bash
codex chat [OPTIONS]
```

#### 聊天选项

| 选项 | 描述 |
|------|------|
| `--model <MODEL>` | 指定 AI 模型 |
| `--platform <PLATFORM>` | 指定 AI 平台 |
| `--context <CONTEXT>` | 添加初始上下文 |

## 5. 高级功能

### 5.1 Solo 模式

Solo 模式是 Codex 的自主工作模式，它可以自动分析你的代码库，生成改进建议，自主修改代码，并验证修改结果。Solo 模式非常适合：

- 代码库重构
- 自动 bug 修复
- 生成测试用例
- 代码质量改进
- 文档自动生成

#### Solo 命令

```bash
codex solo [COMMAND]
```

#### Solo 子命令

| 命令 | 描述 |
|------|------|
| `start` | 启动 Solo 模式，开始分析代码库 |
| `stop` | 停止 Solo 模式 |
| `status` | 查看 Solo 模式当前状态 |
| `tasks` | 查看 Solo 模式生成的任务列表 |
| `task <ID>` | 查看特定任务的详细信息 |
| `approve <ID>` | 批准 Solo 模式的修改建议 |
| `reject <ID>` | 拒绝 Solo 模式的修改建议 |

#### Solo 模式工作流程

1. **代码分析**：Solo 模式首先分析你的代码库，了解代码结构和功能
2. **任务生成**：基于分析结果，生成改进建议和任务列表
3. **执行任务**：自主执行任务，修改代码
4. **验证结果**：运行测试，验证修改是否正确
5. **报告结果**：生成详细的修改报告

#### Solo 模式配置

你可以在配置文件中自定义 Solo 模式的行为：

```yaml
solo:
  # 分析深度：basic, standard, deep
  analysis_depth: "standard"
  # 是否自动执行修改
  auto_execute: false
  # 是否自动运行测试
  auto_test: true
  # 最大并行任务数
  max_parallel_tasks: 3
  # 允许修改的文件类型
  allowed_file_types: [".rs", ".py", ".js", ".ts"]
  # 排除的目录
  exclude_dirs: ["target", "node_modules", ".git"]
```

#### Solo 模式示例

```bash
# 启动 Solo 模式，分析当前目录
codex solo start

# 查看 Solo 模式状态
codex solo status

# 查看生成的任务
codex solo tasks

# 查看特定任务详情
codex solo task 1

# 批准任务修改
codex solo approve 1

# 停止 Solo 模式
codex solo stop
```

### 5.2 工具系统

Codex 内置了一套工具系统，可以执行各种操作。

#### 工具命令

```bash
codex tool <TOOL_NAME> [PARAMETERS]
```

#### 内置工具

| 工具名称 | 描述 |
|----------|------|
| `read_file` | 读取文件内容 |
| `write_file` | 写入文件内容 |
| `edit_file` | 编辑文件内容 |
| `shell` | 执行 Shell 命令 |
| `code_search` | 搜索代码 |
| `git_operation` | 执行 Git 操作 |

### 5.3 插件系统

Codex 支持插件扩展，可以安装和使用第三方插件。

#### 插件命令

```bash
codex plugin [COMMAND]
```

#### 插件子命令

| 命令 | 描述 |
|------|------|
| `list` | 列出已安装的插件 |
| `install <PLUGIN>` | 安装插件 |
| `uninstall <PLUGIN>` | 卸载插件 |
| `enable <PLUGIN>` | 启用插件 |
| `disable <PLUGIN>` | 禁用插件 |
| `info <PLUGIN>` | 查看插件信息 |

## 6. 配置

### 6.1 配置文件位置

Codex 的配置文件位于 `~/.codex/config.yaml`，你可以通过编辑这个文件来自定义 Codex 的行为。

### 6.2 配置选项

#### AI 配置

```yaml
ai:
  default_platform: openai
  default_model: gpt-4o
  platforms:
    openai:
      api_key: "your-api-key"
      base_url: "https://api.openai.com/v1"
      timeout: 30
      retry_count: 3
    anthropic:
      api_key: "your-api-key"
      base_url: "https://api.anthropic.com/v1"
      timeout: 30
      retry_count: 3
    ollama:
      base_url: "http://localhost:11434"
      default_model: llama3
      timeout: 60
      retry_count: 3
```

#### 知识库配置

```yaml
knowledge:
  index_path: "~/.codex/data/index"
  exclude_dirs:
    - target
    - node_modules
    - venv
    - .git
  max_file_size: 10 # MB
  incremental_indexing: true
  cache_size: 1000 # MB
```

#### UI 配置

```yaml
ui:
  theme: default
  enable_animations: true
  enable_syntax_highlighting: true
  history_size: 100
  auto_save: true
  font_size: 14
```

#### 日志配置

```yaml
logging:
  level: info
  file: "~/.codex/logs/app.log"
  max_file_size: 10 # MB
  max_files: 5
```

## 7. 常见问题

### 7.1 如何更新 Codex？

```bash
# 使用安装脚本更新
curl -sSL https://raw.githubusercontent.com/lyxamour/codex/main/scripts/install/install.sh | bash

# 或者使用 Codex 内置的更新命令
codex update
```

### 7.2 如何查看帮助信息？

```bash
# 查看所有命令
codex --help

# 查看特定命令的帮助
codex index --help
```

### 7.3 如何提高 Codex 的响应质量？

1. 提供清晰、详细的问题描述
2. 添加上下文文件或目录
3. 使用适当的模型
4. 优化提示词
5. 提供示例输入输出

## 8. 联系方式

如果你在使用 Codex 过程中遇到问题，可以通过以下方式获取帮助：

- GitHub Issues: https://github.com/lyxamour/codex/issues
- 社区讨论: https://github.com/lyxamour/codex/discussions
- 邮件: contact@lyxamour.com

## 9. 贡献

欢迎你为 Codex 项目贡献代码！贡献流程如下：

1. Fork Codex 仓库
2. 创建一个新的特性分支
3. 实现你的功能或修复
4. 编写测试用例
5. 提交代码并创建 Pull Request
6. 等待代码审查和合并

## 10. 许可证

Codex 使用 MIT 许可证，详细信息请查看 LICENSE 文件。
